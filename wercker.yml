box: debian
  env:
    MONGO_URL: mongodb://mongo:27017/talk
    ROOT_URL: http://localhost:3000
    PORT: 3000
    DEPLOY_METHOD : docker
services:
  - id: mongo
    name: mongo

build:

  steps:
    - script:
        name: Install basic packages
        code: |
            apt-get update && \
            apt-get install -y git curl bzip2 gnupg libcap2-bin && \
            (curl https://deb.nodesource.com/setup_4.x | bash) && \
            apt-get install -y jq && \
            apt-get clean && \
            rm -Rf /var/lib/apt/lists/* /tmp/* /var/tmp/*
    - script:
        name: Install meteor
        code: |
          curl https://install.meteor.com | /bin/sh
          groupadd -g 99999 -r meteor \
          useradd -u 99999 -r -g meteor meteor

    - script:
        name: Build App
        code: | 
          meteor -c "build --server-only /home/meteor/build" meteor
